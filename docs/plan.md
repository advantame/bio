# 開発計画と拡張案（物理パラメータ化・アミノ酸修飾・可視化）

このドキュメントは、Supplementary Information (SI) に基づくモデルを物理パラメータで再構成し、「Gへのアミノ酸結合」という研究目標に合わせてシミュレーションと可視化を拡張するための計画をまとめたものです。

---

## 1. 物理パラメータで直接シミュレーションする

現在は無次元化パラメータ（`β`, `δ`, `λ`, `g`）で実装されているが、SI セクション S3（式 3・4）に戻り、物理的な意味を持つパラメータで表現する：

\[
\begin{aligned}
\frac{dN}{dt} &= k_1 \cdot \mathrm{pol} \cdot G \cdot \frac{N}{1+b \cdot G \cdot N} - k_2 \cdot \mathrm{pol} \cdot N \cdot P - \mathrm{rec} \cdot k_N \cdot \frac{N}{1+\frac{P}{K_{m,P}}} \\
\frac{dP}{dt} &= k_2 \cdot \mathrm{pol} \cdot N \cdot P - \mathrm{rec} \cdot k_P \cdot \frac{P}{1+\frac{P}{K_{m,P}}}
\end{aligned}
\]

- 直感的で実験条件に直結する（`pol`, `rec`, `G` など）。
- アミノ酸修飾の影響仮説（どのパラメータが変動するか）を立てやすい。

### 新しいスライダー候補（初期値は SI 表 S5 を参考）
- 酵素濃度: `pol`, `rec`
- 鋳型 DNA 濃度: `G`
- 反応速度定数: `k1`, `k2`, `k_N`, `k_P`
- 飽和定数: `b`, `K_{m,P}`
- 初期濃度: `N0`, `P0`

---

## 2. アミノ酸修飾の影響モデリング

仮説：G 末端のアミノ酸結合が立体障害を与え、被食者 N の増殖効率が低下する。
- 影響を受ける主要パラメータ: `k1`（被食者 N の増殖効率）
- 実装: `mod_factor`（1.0 = 無修飾, 0.1 = 90% 阻害）を導入し、
  - `k1_modified = k1_baseline * mod_factor`

これにより、阻害強度と振動の周期・振幅・振動消失閾値の変化を定量的に評価可能。

---

## 3. シミュレーションスクリプト群

### スクリプト1: インタラクティブ・シミュレータ（/simulator）
- 物理パラメータをスライダーで操作（`pol, rec, G, k1, k2, k_N, k_P, b, K_{m,P}, N0, P0, mod_factor`）。
- 時系列グラフと位相図（N–P）を同時表示。

### スクリプト2: 分岐図ジェネレータ（/bifurcation）
- 例: `G` を掃引し、長時間積分後の P の最大値・最小値を抽出してプロット。
- どの濃度域で振動が発生/消失するか（ホップ分岐など）を可視化。

### スクリプト3: 2D パラメータ・ヒートマップ（/heatmap）
- 例: 横軸 `G`、縦軸 `k1`（= 修飾効果）で格子探索。
- 各点で周期や振幅を算出し、色で可視化（凡例付き）。

---

## サイトマップ（暫定）

/
- /simulator … 物理パラメータで操作できるインタラクティブ・シミュレータ
- /bifurcation … G 掃引で振幅の最大/最小を描く分岐図
- /heatmap … G と k1（修飾効果）の 2D 空間で周期や振幅のヒートマップ

---

## 開発計画

### フェーズ 1：物理パラメータ化と共通基盤
1. Rust 側 ODE のアップデート
   - 無次元から SI S3（式 3・4）の物理パラメータ形へ変更。
   - `mod_factor` を組み込み、`k1_modified = k1 * mod_factor` を RHS に適用。
2. Wasm / バインディング更新
   - 変更後のパラメータ群・初期値を Rust → JS に公開（wasm-bindgen）。
   - `run_simulation` などをモジュール化し、複数ページから共通利用。
3. UI コンポーネント整理
   - スライダー/入力フォームを汎用化し再利用可能に。

### フェーズ 2：/simulator
1. UI 実装
   - 上記パラメータ入力、時系列＋位相図を Canvas/SVG で描画。
2. 動作確認・パフォーマンス調整

### フェーズ 3：/bifurcation
1. パラメータ掃引ロジック
   - 例: `G` を範囲・刻みで変化。十分な時間積分後に P の Max/Min を記録。
2. 描画
   - 結果を上下包絡線として描画（Canvas/SVG）。
3. UI
   - 掃引対象、ステップ数、シミュレーション時間など設定。

### フェーズ 4：/heatmap
1. 2D グリッド探索
   - 例: (G, k1) グリッド各点でシミュレーション、周期/振幅を集計。
2. 可視化
   - Canvas でヒートマップ描画＋凡例。
3. UI
   - 探索範囲や解像度を指定可能に。

### フェーズ 5：統合と仕上げ
1. トップページ（/）
   - アプリ概要と各ページへのリンク。
2. 共通ヘッダー/フッター
3. ビルド・デプロイ
   - `netlify.toml` のルーティングなど確認。
4. 動作検証
   - 主要パラメータを変えたシミュレーションで期待どおりのシフトを確認。

---

## 期待される成果
- 物理パラメータを直接操作し、実験条件と直結した洞察が得られる。
- アミノ酸修飾の影響を `mod_factor` として数値的に解析し、分岐・パラメータ空間のどこで振動が発生/消失するかを明確化。
- 分岐図・ヒートマップ等の可視化で、振動現象の全体像を立体的に把握。

---

## 実装メモ（このリポジトリ向け）
- Rust（`crate/src/lib.rs`）
  - ODE を物理パラメータに差し替え、`mod_factor` を組み込む。
  - wasm-bindgen でパラメータ構造体と `run_simulation` を公開。
- Web（`/web`）
  - 現行 `index.html` を `/simulator` ベースにリファクタ。
  - 追加ページ `/bifurcation`, `/heatmap` をファイル分割（ルーティングは静的で可）。
  - スライダー/入力の共通 UI ユーティリティを切り出す。
  - Workbench は ΔΔG↔r 連動のロック表示、比率入力のレンジチェック、hairpin 開口率表示、SI 既定値へのリセットを備え、Fit ワークフローは Huber / OLS 切替と自動ベースライン検出を実装済み。
- ビルド
  - 既存の `netlify-build.sh`, `netlify.toml` を流用（必要に応じて調整）。

> 注: 実数値の初期値や範囲は SI 表 S5 を参照して設定すること。
