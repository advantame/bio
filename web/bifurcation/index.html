<!doctype html>
<meta charset="utf-8">
<title>分岐図ジェネレータ — PP-oscillation</title>
<style>
  :root { --line:#e5e7eb; --muted:#666; }
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin:16px; background:#fafafa; }
  .wrap { display:flex; flex-direction:column; gap:16px; }
  .card { background:#fff; border:1px solid var(--line); border-radius:12px; padding:14px; box-shadow:0 1px 2px rgba(0,0,0,.03); }
  .note { color:var(--muted); font-size:.92rem; line-height:1.6; margin-top:8px; }
  canvas { background:#fff; border:1px solid var(--line); border-radius:10px; width:100%; height:460px; }
  .rows { display:grid; grid-template-columns: 160px 1fr 120px; gap:10px 10px; align-items:center; }
  .row { display:contents; }
  input[type="range"] { width:100%; }
  input[type="number"], select { width:100%; box-sizing:border-box; }
  .buttons { display:flex; gap:10px; margin-top:12px; }
  button { padding:8px 12px; border-radius:8px; border:1px solid #d1d5db; background:#f8f8f8; cursor:pointer; }
  button:hover { background:#f0f0f0; }
</style>

<div class="wrap">
  <div class="card">
    <h2 style="margin:4px 0 10px;">分岐図ジェネレータ</h2>
    <div style="display:flex; gap:16px; flex-wrap:wrap;">
      <div style="flex:1 1 420px; min-width:360px;">
        <canvas id="cv" width="1200" height="480"></canvas>
        <div id="status" class="note"></div>
      </div>
      <div class="card" style="flex:1 1 320px; min-width:320px;">
        <div class="rows">
          <div class="row">
            <label for="param">掃引パラメータ</label>
            <select id="param">
              <option value="G">G (template DNA)</option>
              <option value="k1">k1 (growth)</option>
              <option value="pol">pol</option>
              <option value="rec">rec</option>
              <option value="KmP">KP (Km,P)</option>
              <option value="mod_factor">mod_factor</option>
            </select>
            <div></div>
          </div>
          <div class="row">
            <label for="pmin">最小値</label>
            <input id="pmin" type="number" step="0.01" value="0">
            <div></div>
          </div>
          <div class="row">
            <label for="pmax">最大値</label>
            <input id="pmax" type="number" step="0.01" value="400">
            <div></div>
          </div>
          <div class="row">
            <label for="steps">ステップ数</label>
            <input id="steps" type="number" step="1" value="60">
            <div></div>
          </div>
          <div class="row">
            <label for="t_end">t_end [min]</label>
            <input id="t_end" type="number" step="100" value="2600">
            <div></div>
          </div>
          <div class="row">
            <label for="dt">dt [min]</label>
            <input id="dt" type="number" step="0.1" value="1">
            <div></div>
          </div>
          <div class="row">
            <label for="tail">評価区間（末尾%）</label>
            <input id="tail" type="number" step="1" value="30">
            <div></div>
          </div>
          <!-- 基本パラメータ（ベース値） -->
          <div class="row"><label>pol</label><input id="pol" type="number" step="0.01" value="1"><div></div></div>
          <div class="row"><label>rec</label><input id="rec" type="number" step="0.01" value="1"><div></div></div>
          <div class="row"><label>G</label><input id="G" type="number" step="1" value="160"><div></div></div>
          <div class="row"><label>k1</label><input id="k1" type="number" step="0.01" value="1"><div></div></div>
          <div class="row"><label>k2</label><input id="k2" type="number" step="0.01" value="0.1"><div></div></div>
          <div class="row"><label>kN</label><input id="kN" type="number" step="0.01" value="1"><div></div></div>
          <div class="row"><label>kP</label><input id="kP" type="number" step="0.01" value="1"><div></div></div>
          <div class="row"><label>b</label><input id="b" type="number" step="0.0005" value="0.005"><div></div></div>
          <div class="row"><label>KmP</label><input id="KmP" type="number" step="1" value="34"><div></div></div>
          <div class="row"><label>N0 [nM]</label><input id="N0" type="number" step="0.1" value="10"><div></div></div>
          <div class="row"><label>P0 [nM]</label><input id="P0" type="number" step="0.1" value="10"><div></div></div>
          <div class="row"><label>mod_factor</label><input id="mod_factor" type="number" step="0.01" value="1"><div></div></div>
        </div>
        <div class="buttons">
          <button id="runBtn">Run</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 説明セクション -->
  <div class="card" style="margin-top:8px;">
    <h3 style="margin:0 0 8px;">ページ2: 分岐図ジェネレータ</h3>
    <h4 style="margin:0 0 6px;">このツールについて</h4>
    <p>
      このツールは、DNA発振器の挙動が<strong>質的に変化する「転移点」</strong>を特定するための高度な分析ツールです。ある特定のパラメータ（例：鋳型DNA濃度 <code>G</code>）を少しずつ変化させたときに、系の長期的な振る舞い（安定な状態か、振動状態か）がどのように変わるかを<strong>分岐図</strong>として可視化します。
    </p>
    <p>
      グラフの横軸はあなたが選んだパラメータ（例：<code>G</code>）、縦軸は長時間経過後の安定した状態における捕食者(P)の濃度を示します。線が一本の場合は系が安定な定常状態にあることを、線が二本に分かれている（分岐している）場合は、系が周期的に振動していること（最大値と最小値）を示します。
    </p>
    <p>
      <em>文脈:</em> 実際の化学実験では、試薬の濃度をわずかに変えるだけで、振動が突然始まったり止まったりする現象が起こります。このツールは、その「振動が生まれるパラメータの範囲」を<strong>理論的に予測する</strong>ために不可欠です。例えば、「アミノ酸修飾によって反応効率<code>k₁</code>が低下すると、振動が始まるために必要な<code>G</code>濃度は高くなるはずだ」といった、より鋭い仮説を検証するために使用します。これは論文の補足情報(SI)でも、系の安定性を議論するために多用されている分析手法です。
    </p>
  </div>
</div>

<script type="module" src="./bifurcation.js"></script>
