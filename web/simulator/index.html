<!doctype html>
<meta charset="utf-8">
<title>Simulator (Physical Params) — PP-oscillation</title>
<style>
  :root { --line:#e5e7eb; --muted:#666; }
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin:16px; background:#fafafa; }
  .wrap { display:flex; flex-direction:column; gap:16px; }
  .card { background:#fff; border:1px solid var(--line); border-radius:12px; padding:14px; box-shadow:0 1px 2px rgba(0,0,0,.03); }
  .nav { display:flex; gap:12px; flex-wrap:wrap; padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; }
  .nav a { color:#2563eb; text-decoration:none; }
  .nav a:hover { text-decoration:underline; }

  .canvas-row { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
  canvas { background:#ffffff; border:1px solid var(--line); border-radius:10px; width:100%; height:420px; }

  .legend { display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-top:8px; color:#0f172a; }
  .legend-item { display:inline-flex; gap:10px; align-items:center; padding:4px 10px; border:1px solid var(--line); border-radius:10px; background:#f8fafc; font-size:.9rem; }
  .legend-item strong { font-weight:600; color:#0f172a; }
  .legend-mode { display:inline-flex; gap:6px; align-items:center; color:#475569; font-size:.84rem; }
  .swatch { display:inline-block; width:12px; height:12px; border-radius:2px; }
  .note { color:var(--muted); font-size:.92rem; line-height:1.6; margin-top:8px; }
  #status { margin-top:6px; color:#555; font-size:.9rem; }

  .controls.card { padding:16px; }
  .rows { display:grid; grid-template-columns: 160px 1fr 100px; gap:10px 10px; align-items:center; }
  .row { display:contents; }
  input[type="range"] { width:100%; }
  input[type="number"] { width:100%; box-sizing:border-box; }
  .buttons { display:flex; gap:10px; margin-top:12px; }
  button { padding:8px 12px; border-radius:8px; border:1px solid #d1d5db; background:#f8f8f8; cursor:pointer; }
  button:hover { background:#f0f0f0; }

  .badge { display:none; align-items:center; gap:8px; padding:4px 10px; background:#e2e8f0; border:1px solid #cbd5e1; border-radius:999px; margin-bottom:8px; font-size:.9rem; color:#0f172a; width:fit-content; }
  .dot { width:8px; height:8px; border-radius:50%; background:#0f172a; animation:pulse 1s ease-in-out infinite; }
  @keyframes pulse { 0%{opacity:.2} 50%{opacity:1} 100%{opacity:.2} }

  @media (max-width: 980px) { .canvas-row { grid-template-columns: 1fr; } }
</style>

<div class="wrap">
  <div class="nav">
    <a href="../">Home</a>
    <span>·</span>
    <a href="../simulator/">Simulator</a>
    <span>·</span>
    <a href="../bifurcation/">Bifurcation</a>
    <span>·</span>
    <a href="../heatmap/">Heatmap</a>
    <span>·</span>
    <a href="../workbench/">Modification Workbench</a>
  </div>

  <div class="card">
    <h2 style="margin:4px 0 10px;">Physical-Parameter Simulator</h2>
    <div id="busy" class="badge"><div class="dot"></div><span>Rendering…</span></div>
    <div class="canvas-row">
      <canvas id="cv_ts" width="1000" height="440"></canvas>
      <canvas id="cv_phase" width="1000" height="440"></canvas>
    </div>

    <div class="legend" id="legend"></div>

    <div id="status"></div>
    <p class="note">
      物理パラメータ（SI S3, 式3・4）で計算。アミノ酸修飾などは <a href="../workbench/">Modification Workbench</a> で管理され、ここではその効果が自動反映されます。
    </p>
  </div>

  <div class="controls card">
    <h3 style="margin:0 0 8px;">Parameters</h3>
    <div class="rows">
      <div class="row">
        <label for="pol">pol (polymerase)</label>
        <input id="pol" type="range" min="0" max="10" step="0.1" value="3.7">
        <input id="pol_n" type="number" step="0.1" value="3.7">
      </div>
      <div class="row">
        <label for="rec">rec (ttRecJ)</label>
        <input id="rec" type="range" min="0" max="100" step="0.1" value="32.5">
        <input id="rec_n" type="number" step="0.1" value="32.5">
      </div>
      <div class="row">
        <label for="G">G (template DNA)</label>
        <input id="G" type="range" min="0" max="400" step="1" value="160">
        <input id="G_n" type="number" step="1" value="160">
      </div>
      <div class="row">
        <label for="k1">k1 (growth eff.)</label>
        <input id="k1" type="range" min="0" max="0.02" step="0.0001" value="0.002">
        <input id="k1_n" type="number" step="0.0001" value="0.002">
      </div>
      <div class="row">
        <label for="k2">k2 (predation eff.)</label>
        <input id="k2" type="range" min="0" max="0.02" step="0.0001" value="0.0031">
        <input id="k2_n" type="number" step="0.0001" value="0.0031">
      </div>
      <div class="row">
        <label for="kN">k_N (N degradation)</label>
        <input id="kN" type="range" min="0" max="0.1" step="0.0001" value="0.021">
        <input id="kN_n" type="number" step="0.0001" value="0.021">
      </div>
      <div class="row">
        <label for="kP">k_P (P degradation)</label>
        <input id="kP" type="range" min="0" max="0.05" step="0.0001" value="0.0047">
        <input id="kP_n" type="number" step="0.0001" value="0.0047">
      </div>
      <div class="row">
        <label for="b">b (saturation)</label>
        <input id="b" type="range" min="0" max="0.001" step="0.000001" value="0.000048">
        <input id="b_n" type="number" step="0.000001" value="0.000048">
      </div>
      <div class="row">
        <label for="KmP">K<sub>m,P</sub></label>
        <input id="KmP" type="range" min="1" max="200" step="1" value="34">
        <input id="KmP_n" type="number" step="1" value="34">
      </div>
      <div class="row">
        <label for="N0">N₀ [nM]</label>
        <input id="N0" type="range" min="0" max="400" step="0.1" value="10">
        <input id="N0_n" type="number" step="0.1" value="10">
      </div>
      <div class="row">
        <label for="P0">P₀ [nM]</label>
        <input id="P0" type="range" min="0" max="400" step="0.1" value="10">
        <input id="P0_n" type="number" step="0.1" value="10">
      </div>
      <div class="row">
        <label for="t_end">t_end [min]</label>
        <input id="t_end" type="range" min="100" max="10000" step="100" value="2600">
        <input id="t_end_n" type="number" step="100" value="2600">
      </div>
      <div class="row">
        <label for="dt">dt [min]</label>
        <input id="dt" type="range" min="0.1" max="10" step="0.1" value="1">
        <input id="dt_n" type="number" step="0.1" value="1">
      </div>
    </div>

    <div class="buttons">
      <button id="resetBtn">Reset</button>
    </div>
  </div>

  <!-- 説明セクション -->
  <div class="card" style="margin-top:8px;">
    <h3 style="margin:0 0 8px;">ページ1: インタラクティブ・シミュレータ</h3>
    <h4 style="margin:0 0 6px;">このツールについて</h4>
    <p>
      このシミュレータは、論文で報告された<strong>捕食者-被食者モデル</strong>に基づき、DNA鎖の濃度が周期的に変化する「DNA発振器」の基本挙動をリアルタイムで探るためのツールです。スライダーを動かすことで、酵素濃度やDNA濃度といった<strong>実験条件に直接対応する物理パラメータ</strong>を変化させ、濃度振動がどのように変わるかを視覚的に理解できます。
    </p>
    <p>
      グラフには、時間経過に伴う各DNA鎖（被食者N、捕食者P）の濃度変化と、被食者(N)と捕食者(P)の相関関係を示す位相図が表示されます。位相図が安定した円形の軌道（リミットサイクル）を描くとき、系は安定した振動状態にあることを意味します。
    </p>
    <p>
      このシミュレーションは、以下の<strong>連立常微分方程式</strong>に基づいています。
    </p>
    <!-- 数式は画像で埋め込み（画像は後で提供） -->
    <div style="display:flex; justify-content:center; margin:12px 0;">
      <img src="../equation.png" alt="連立常微分方程式 (dN/dt, dP/dt)" style="max-width:100%; height:auto;">
    </div>
    <p>
      <em>文脈:</em> このツールは、特定の実験条件下でどのような振動が生まれるかを直感的に把握し、基本的なパラメータ感受性を理解するために作成されました。特に、あなたの研究テーマである「DNAへのアミノ酸修飾」が、どのパラメータ(<code>k₁</code>など)に影響を与え、振動をどう変えるかの当たりをつける第一歩として役立ちます。
    </p>
  </div>
</div>

<script type="module" src="./simulator.js"></script>
